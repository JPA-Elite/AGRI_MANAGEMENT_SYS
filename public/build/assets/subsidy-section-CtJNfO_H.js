import{c as v,b as j,a as b,d as k,e as A,j as e,r as x,u as L,s as y}from"./app-CqqwN4Ys.js";import{S as $}from"./spinner-BvT-unYJ.js";import{h as w}from"./moment-C5S46NFB.js";import{S as N}from"./sweetalert2.esm.all-89IKscqO.js";import{F as D}from"./XMarkIcon-WBHvBhfW.js";import{z as _}from"./transition-BSrbUO8S.js";import{y as u}from"./dialog-Cm3r6xFY.js";import{O as R}from"./overlay-spinner-BpH5fNRF.js";import"./use-server-handoff-complete-BmBzsm-3.js";import"./use-tab-direction-ZqiLoBEn.js";const g=v("subsidy/getSubsidies",async(r,{dispatch:i})=>{try{i(j(!0));const s=await b.get("/api/subsidies");i(k(s.data))}catch(s){i(A(s.message))}finally{i(j(!1))}});v("subsidy/approveSubsidy",async(r,{dispatch:i})=>{try{await b.put(`/api/subsidies/${r}/approve`),i(g())}catch(s){throw s}});function V({isOpen:r,setIsOpen:i,data:s}){var l,m,o,d,n,p;return e.jsx(_,{show:r,as:x.Fragment,children:e.jsxs(u,{onClose:()=>i(!1),className:"relative z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsxs(u.Panel,{className:"mx-auto w-full max-w-4xl h-[90vh] rounded-lg bg-white p-6 overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white pb-4 mb-4 border-b",children:[e.jsx(u.Title,{className:"text-xl font-semibold",children:"View Subsidy Details"}),e.jsx("button",{onClick:()=>i(!1),className:"absolute top-0 right-0",children:e.jsx(D,{className:"h-6 w-6 text-gray-500"})})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Beneficiary Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Name"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:`${((l=s==null?void 0:s.beneficiary)==null?void 0:l.firstname)??""} ${((m=s==null?void 0:s.beneficiary)==null?void 0:m.lastname)??""}`})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"RSBSA Number"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:((o=s==null?void 0:s.beneficiary)==null?void 0:o.register_id)??"N/A"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Barangay"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:((d=s==null?void 0:s.beneficiary)==null?void 0:d.barangay)??"N/A"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Main Livelihood"}),e.jsx("span",{className:"mt-1 inline-flex items-center rounded-full bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-green-600/20 ring-inset",children:((p=(n=s==null?void 0:s.beneficiary)==null?void 0:n.farm_profile)==null?void 0:p.main_livelihood)??"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Subsidy Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Amount"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:["₱",s==null?void 0:s.amount]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx("span",{className:`mt-1 inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${(s==null?void 0:s.status)==="approved"?"bg-green-50 text-green-700 ring-green-600/20":"bg-yellow-50 text-yellow-700 ring-yellow-600/20"}`,children:s==null?void 0:s.status})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Date Released"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:w(s==null?void 0:s.date_released).format("LLL")})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Additional Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:s==null?void 0:s.description})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Remarks"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:s==null?void 0:s.remarks})]})]})]})]})]})})]})})}function P(){const{subsidies:r,loading:i}=L(t=>t.subsidy),[s,l]=x.useState(!1),[m,o]=x.useState(null),[d,n]=x.useState(!1),p=t=>{o(t),l(!0)},S=async(t,a)=>{var c,h;try{n(!0),await axios.put(`/api/subsidies/${t}/status`,{status:a}),await y.dispatch(g()),N.fire({title:"Success!",text:`Subsidy status updated to ${a}`,icon:"success",timer:1500})}catch(f){console.error("Status update error:",f),N.fire({title:"Error!",text:((h=(c=f.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to update status",icon:"error"})}finally{n(!1)}};return x.useEffect(()=>{y.dispatch(g())},[]),i?e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx($,{size:"h-8 w-8",color:"text-green-500"}),e.jsx("span",{className:"ml-2",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{isLoading:d}),e.jsx(V,{isOpen:s,setIsOpen:l,data:m}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"sm:flex sm:items-center",children:e.jsxs("div",{className:"sm:flex-auto",children:[e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"Subsidy Records"}),e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:"A list of all the subsidies in the system."})]})}),e.jsx("div",{className:"mt-8 flow-root",children:e.jsx("div",{className:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:e.jsx("div",{className:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Subsidy Name"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Amount"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Beneficiary Type"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Date Released"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Status"}),e.jsx("th",{scope:"col",className:"relative py-3 pl-3 pr-4 sm:pr-0",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:r.map(t=>{var a,c;return e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm uppercase text-gray-900",children:e.jsx("div",{className:"max-w-xs overflow-hidden overflow-ellipsis",title:t.description,children:t.description})}),e.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:["₱",t.amount]}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"inline-flex items-center rounded-full bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-green-600/20 ring-inset mb-1",children:((c=(a=t.beneficiary)==null?void 0:a.farm_profile)==null?void 0:c.main_livelihood)??"N/A"})})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:w(t.date_released).format("LLL")}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:e.jsxs("select",{value:t.status,onChange:h=>S(t.id,h.target.value),disabled:t.status!=="pending",className:`rounded-full px-2 py-1 text-xs font-semibold cursor-${t.status==="pending"?"pointer":"not-allowed"} ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="declined"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"declined",children:"Declined"})]})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:e.jsx("button",{onClick:()=>p(t),className:"text-blue-600 hover:text-blue-900",children:"View Details"})})]},t.id)})})]})})})})]})]})}export{P as default};
