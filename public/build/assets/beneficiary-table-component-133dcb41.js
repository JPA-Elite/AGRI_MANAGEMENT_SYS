import{r as c,j as e,a as M,u as C,x as R,s as N}from"./app-a5216411.js";import{g as B,v as $}from"./personal-information-thunk-b6a98258.js";import{S as v}from"./sweetalert2.esm.all-7820e9f9.js";import{S as _}from"./spinner-3b03a083.js";import{O as E}from"./overlay-spinner-e8dd5551.js";import{X as z}from"./XMarkIcon-7157b5df.js";import{z as D}from"./transition-d78c70a8.js";import{y as S}from"./dialog-07d1dcbf.js";import{L as O,B as P,a as y,M as q}from"./general-3006e717.js";import"./use-server-handoff-complete-cf473f0c.js";import"./use-tab-direction-67ac194f.js";function I({isOpen:i,setIsOpen:x,beneficiaryId:m}){const[a,r]=c.useState({amount:"",description:"",date_released:"",remarks:""}),p=async l=>{var j,n;l.preventDefault();try{await M.post("/api/subsidies",{...a,beneficiary_id:m}),x(!1),await v.fire({title:"Success!",text:"Subsidy has been added successfully",icon:"success",showConfirmButton:!1,timer:1500}),r({amount:"",description:"",date_released:"",remarks:""})}catch(g){console.error("Error adding subsidy:",g),await v.fire({title:"Error!",text:((n=(j=g.response)==null?void 0:j.data)==null?void 0:n.message)||"Failed to add subsidy",icon:"error",showConfirmButton:!0})}};return e.jsx(D,{show:i,as:c.Fragment,children:e.jsxs(S,{onClose:()=>x(!1),className:"relative z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsxs(S.Panel,{className:"mx-auto w-full max-w-4xl h-[90vh] rounded-lg bg-white p-6 overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white pb-4 mb-4 border-b",children:[e.jsx(S.Title,{className:"text-xl font-semibold",children:"Request for Subsidy"}),e.jsx("button",{onClick:()=>x(!1),className:"absolute top-0 right-0",children:e.jsx(z,{className:"h-6 w-6 text-gray-500"})})]}),e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Amount"}),e.jsx("input",{type:"number",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",value:a.amount,onChange:l=>r({...a,amount:l.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",value:a.description,onChange:l=>r({...a,description:l.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date Released"}),e.jsx("input",{type:"date",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",value:a.date_released,onChange:l=>r({...a,date_released:l.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),e.jsx("textarea",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",value:a.remarks,onChange:l=>r({...a,remarks:l.target.value})})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-500",children:"Add Subsidy"})]})]})]})})]})})}function F({beneficiaries:i,filters:x}){const[m,a]=c.useState("all"),[r,p]=c.useState("all"),l=i.filter(s=>{var u,f,w;const o=m==="all"||((f=(u=s.farm_profile)==null?void 0:u.main_livelihood)==null?void 0:f.toLowerCase())===m.toLowerCase(),d=r==="all"||((w=s.barangay)==null?void 0:w.toLowerCase())===r.toLowerCase();return o&&d});[...new Set(i.map(s=>s.barangay))],[...new Set(i.map(s=>{var o;return(o=s.farm_profile)==null?void 0:o.main_livelihood}).filter(Boolean))];const n=(()=>({center:r!=="all"?y[r]:q,zoom:r!=="all"?15:13,markers:l.map(d=>{var u,f;return{lat:(u=y[d.barangay])==null?void 0:u.lat,lng:(f=y[d.barangay])==null?void 0:f.lng,title:`${d.firstname} ${d.lastname} - ${d.barangay}`}}).filter(d=>d.lat&&d.lng)}))(),g=`https://www.openstreetmap.org/export/embed.html?bbox=${n.center.lng-.02}%2C${n.center.lat-.02}%2C${n.center.lng+.02}%2C${n.center.lat+.02}&layer=mapnik&zoom=${n.zoom}`+n.markers.map(s=>`&marker=${s.lat},${s.lng}&title=${encodeURIComponent(s.title)}`).join("");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("select",{value:m,onChange:s=>a(s.target.value),className:"rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",children:[e.jsx("option",{value:"all",children:"All Livelihoods"}),O.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:r,onChange:s=>p(s.target.value),className:"rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",children:[e.jsx("option",{value:"all",children:"All Barangays"}),P.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 h-[85vh] border rounded-lg overflow-hidden shadow-inner",children:e.jsx("iframe",{width:"100%",height:"100%",frameBorder:"0",scrolling:"no",marginHeight:"0",marginWidth:"0",src:g})}),e.jsx("div",{className:"lg:col-span-1 h-[85vh] overflow-y-auto",children:e.jsx("div",{className:"space-y-4",children:l.map(s=>{var o;return e.jsxs("div",{className:"p-3 bg-white rounded-lg shadow hover:shadow-md transition-shadow duration-200 cursor-pointer",onClick:()=>p(s.barangay),children:[e.jsxs("h3",{className:"font-semibold",children:[s.firstname," ",s.lastname]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["RSBSA: ",s.register_id]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Livelihood: ",(o=s.farm_profile)==null?void 0:o.main_livelihood]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Barangay: ",s.barangay]}),y[s.barangay]&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Coordinates: ",y[s.barangay].lat,", ",y[s.barangay].lng]})]},s.id)})})})]})]})}function Z(){var k;const{personal_informations:i}=C(t=>t.personal_information);C(t=>t.app);const[x,m]=c.useState(null),[a,r]=c.useState(!1),[p,l]=c.useState(!0),[j,n]=c.useState(!1),[g,s]=c.useState(null),[o,d]=c.useState(!1),u=["active","inactive"],w=new URLSearchParams(window.location.search).get("status");c.useEffect(()=>{(async()=>{try{await N.dispatch(B())}finally{l(!1)}})()},[]);const A=async(t,b)=>{m(null),r(!0);try{await N.dispatch($({...t,status:b})),N.dispatch(B()),await v.fire({title:"Success!",text:`Status updated successfully to ${b}`,icon:"success",showConfirmButton:!1,timer:1500})}catch(h){console.error("Error updating status:",h),await v.fire({title:"Error!",text:"Failed to update status",icon:"error",showConfirmButton:!0})}finally{r(!1)}},L=t=>{s(t),n(!0)};return p?e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx(_,{size:"h-8 w-8",color:"text-green-500"}),e.jsx("span",{className:"ml-2",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{isLoading:a}),e.jsx(I,{isOpen:j,setIsOpen:n,beneficiaryId:g}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 mt-8",children:[e.jsxs("div",{className:"sm:flex sm:items-center",children:[e.jsxs("div",{className:"sm:flex-auto",children:[e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"Active Beneficiary"}),e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:"A list of all the active benefeciary in the system including their rsbsa number, registration no., fullname, association and livelihood."})]}),e.jsx("div",{className:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none space-x-4",children:e.jsx("button",{onClick:()=>d(!o),className:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500",children:o?"Show Table":"Show Map"})})]}),o?e.jsx("div",{className:"mt-8",children:e.jsx(F,{beneficiaries:(i==null?void 0:i.data)||[],filters:{status:w}})}):e.jsx("div",{className:"mt-8 flow-root",children:e.jsx("div",{className:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:e.jsx("div",{className:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-3 pl-4 pr-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500 sm:pl-0",children:"RSBSA No."}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Register No."}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Lastname"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Firstname"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Middlename"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Livelihood/Organization"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Status"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Barangay"}),e.jsx("th",{scope:"col",className:"relative py-3 pl-3 pr-4 sm:pr-0",children:e.jsx("span",{className:"sr-only",children:"Edit"})})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:(k=i==null?void 0:i.data)==null?void 0:k.map(t=>{var b;return e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-0",children:t.register_id}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:t.id}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm uppercase text-gray-900",children:t.lastname}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm uppercase text-gray-900",children:t.firstname}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm uppercase text-gray-900",children:t.middlename}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:e.jsx("p",{className:"text-gray-500 italic",children:((b=t==null?void 0:t.farm_profile)==null?void 0:b.main_livelihood)??"N/A"})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:x===t.id?e.jsx("select",{className:"rounded-md border-gray-300 text-xs focus:border-green-500 focus:ring-green-500",defaultValue:t.status,onChange:h=>A(t,h.target.value),onBlur:()=>m(null),disabled:a,children:a?e.jsxs("div",{className:"flex items-center justify-center py-1",children:[e.jsx(_,{size:"h-4 w-4",color:"text-green-500"}),e.jsx("span",{className:"ml-2",children:"Updating..."})]}):u.map(h=>e.jsx("option",{value:h,children:h},h))}):e.jsx("span",{onClick:()=>m(t.id),className:`inline-flex cursor-pointer items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${t.status==="active"?"bg-green-50 text-green-700 ring-green-600/20":t.status==="inactive"?"bg-yellow-50 text-yellow-700 ring-yellow-600/20":"bg-red-50 text-red-700 ring-red-600/20"}`,children:t.status})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm uppercase text-gray-900",children:t.barangay}),e.jsx("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(R,{href:`/administrator/profile/${t.id}`,className:"text-indigo-600 hover:text-indigo-900",children:["View Profile",e.jsxs("span",{className:"sr-only",children:[", ",t.rsbsa]})]}),w==="active"&&e.jsx("button",{onClick:()=>L(t.id),className:"inline-flex items-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500",children:"Request Subsidy"})]})})]},t.email)})})]})})})})]})]})}export{Z as default};
