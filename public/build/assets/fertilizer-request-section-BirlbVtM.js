import{r as a,u as N,s as d,j as e,a as b}from"./app-B3jHPcCa.js";import{g as c,A as S}from"./add-fertilizer-request-modal-DkRh9wIl.js";import v from"./view-fertilizer-request-modal-D3axvN56.js";import{h as R}from"./moment-C5S46NFB.js";import{S as z}from"./spinner-pKk462YC.js";import{b as O}from"./general-DOL9TG6R.js";import{S as x}from"./sweetalert2.esm.all-89IKscqO.js";import"./beneficiary-thunk-tUH7426m.js";import"./XMarkIcon-vqDBNsVt.js";import"./transition-CYx2j0Hx.js";import"./use-server-handoff-complete-a0y8Xujw.js";import"./dialog-D8wCObpc.js";import"./use-tab-direction-BsqZ-6zh.js";function $(){var o;const[m,l]=a.useState(!1),[p,i]=a.useState(null),[h,u]=a.useState(null),[f,n]=a.useState(!1),{fertilizer_requests:r,loading:g}=N(t=>t.fertilizer_request);a.useEffect(()=>{d.dispatch(c())},[]);const y=async(t,s)=>{i(null);try{await b.put(`/api/fertilizer-requests/${t.id}/status`,{status:s}),await d.dispatch(c()),await x.fire({title:"Success!",text:`Status updated successfully to ${s}`,icon:"success",showConfirmButton:!1,timer:1500})}catch(w){console.error("Error updating status:",w),await x.fire({title:"Error!",text:"Failed to update status",icon:"error",showConfirmButton:!0})}},j=t=>{u(t),n(!0)};return g?e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx(z,{size:"h-8 w-8",color:"text-green-500"}),e.jsx("span",{className:"ml-2",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{isOpen:m,setIsOpen:l}),e.jsx(v,{isOpen:f,setIsOpen:n,data:h}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:flex sm:items-center",children:[e.jsxs("div",{className:"sm:flex-auto",children:[e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"Fertilizer Requests"}),e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:"List of fertilizer requests from beneficiaries"})]}),e.jsx("div",{className:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none",children:e.jsx("button",{onClick:()=>l(!0),className:"block rounded-md bg-green-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-green-500",children:"Add Request"})})]}),e.jsx("div",{className:"mt-8 flow-root",children:e.jsx("div",{className:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:e.jsx("div",{className:"inline-block min-w-full py-2 align-middle",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Beneficiary"}),e.jsx("th",{className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Fertilizer Type"}),e.jsx("th",{className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Quantity"}),e.jsx("th",{className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Requested Date"}),e.jsx("th",{className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Status"}),e.jsx("th",{className:"px-3 py-3.5 text-center text-sm font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:(o=r==null?void 0:r.data)==null?void 0:o.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:[t.beneficiary.firstname," ",t.beneficiary.lastname]}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:t.fertilizer_type}),e.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:[t.quantity," bags"]}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:R(t.requested_date).format("LL")}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:p===t.id?e.jsx("select",{className:"rounded-md border-gray-300 text-xs focus:border-green-500 focus:ring-green-500",defaultValue:t.status,onChange:s=>y(t,s.target.value),onBlur:()=>i(null),children:O.map(s=>e.jsx("option",{value:s,children:s},s))}):e.jsx("span",{onClick:()=>i(t.id),className:`inline-flex cursor-pointer rounded-full px-2 text-xs font-semibold leading-5 ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-center text-sm font-medium",children:e.jsx("button",{onClick:()=>j(t),className:"text-indigo-600 hover:text-indigo-900",children:"View Details"})})]},t.id))})]})})})})]})]})}export{$ as default};
