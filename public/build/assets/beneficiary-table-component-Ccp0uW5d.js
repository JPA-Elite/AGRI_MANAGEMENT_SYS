import{r as d,j as e,a as M,u as B,x as $,s as N}from"./app-CDlVvaBC.js";import{g as _,v as E}from"./personal-information-thunk-DBwg42Qx.js";import{S as b}from"./sweetalert2.esm.all-89IKscqO.js";import{S as A}from"./spinner-gCnl71wD.js";import{O as z}from"./overlay-spinner-hhbJ6YEv.js";import{F as D}from"./XMarkIcon-DFrk44HQ.js";import{z as O}from"./transition-PLLi1leS.js";import{y as S}from"./dialog-D-2vtU3f.js";import{L as P,B as F,a as y,M as q}from"./general-DOL9TG6R.js";import"./use-server-handoff-complete-BLa6PwUx.js";import"./use-tab-direction-DxaSVcCC.js";function I({isOpen:n,setIsOpen:f,beneficiaryId:m}){const[r,a]=d.useState({amount:"",description:"",date_released:"",remarks:""}),x=async l=>{var j,o;l.preventDefault();try{await M.post("/api/subsidies",{...r,beneficiary_id:m}),f(!1),await b.fire({title:"Success!",text:"Subsidy has been added successfully",icon:"success",showConfirmButton:!1,timer:1500}),a({amount:"",description:"",date_released:"",remarks:""})}catch(u){console.error("Error adding subsidy:",u),await b.fire({title:"Error!",text:((o=(j=u.response)==null?void 0:j.data)==null?void 0:o.message)||"Failed to add subsidy",icon:"error",showConfirmButton:!0})}};return e.jsx(O,{show:n,as:d.Fragment,children:e.jsxs(S,{onClose:()=>f(!1),className:"relative z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsxs(S.Panel,{className:"mx-auto w-full max-w-4xl h-[90vh] rounded-lg bg-white p-6 overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white pb-4 mb-4 border-b",children:[e.jsx(S.Title,{className:"text-xl font-semibold",children:"Request for Subsidy"}),e.jsx("button",{onClick:()=>f(!1),className:"absolute top-0 right-0",children:e.jsx(D,{className:"h-6 w-6 text-gray-500"})})]}),e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Amount"}),e.jsx("input",{type:"number",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",value:r.amount,onChange:l=>a({...r,amount:l.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",value:r.description,onChange:l=>a({...r,description:l.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date Released"}),e.jsx("input",{type:"date",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",value:r.date_released,onChange:l=>a({...r,date_released:l.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),e.jsx("textarea",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",value:r.remarks,onChange:l=>a({...r,remarks:l.target.value})})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",onClick:()=>f(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-500",children:"Add Subsidy"})]})]})]})})]})})}function T({beneficiaries:n,filters:f}){const[m,r]=d.useState("all"),[a,x]=d.useState("all"),l=n.filter(s=>{var h,p,v;const c=m==="all"||((p=(h=s.farm_profile)==null?void 0:h.main_livelihood)==null?void 0:p.toLowerCase())===m.toLowerCase(),i=a==="all"||((v=s.barangay)==null?void 0:v.toLowerCase())===a.toLowerCase();return c&&i});[...new Set(n.map(s=>s.barangay))],[...new Set(n.map(s=>{var c;return(c=s.farm_profile)==null?void 0:c.main_livelihood}).filter(Boolean))];const o={center:a!=="all"?y[a]:q,zoom:a!=="all"?15:13,markers:l.map(i=>{var h,p;return{lat:(h=y[i.barangay])==null?void 0:h.lat,lng:(p=y[i.barangay])==null?void 0:p.lng,title:`${i.firstname} ${i.lastname} - ${i.barangay}`}}).filter(i=>i.lat&&i.lng)},u=`https://www.openstreetmap.org/export/embed.html?bbox=${o.center.lng-.02}%2C${o.center.lat-.02}%2C${o.center.lng+.02}%2C${o.center.lat+.02}&layer=mapnik&zoom=${o.zoom}`+o.markers.map(s=>`&marker=${s.lat},${s.lng}&title=${encodeURIComponent(s.title)}`).join("");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("select",{value:m,onChange:s=>r(s.target.value),className:"rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",children:[e.jsx("option",{value:"all",children:"All Livelihoods"}),P.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:a,onChange:s=>x(s.target.value),className:"rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",children:[e.jsx("option",{value:"all",children:"All Barangays"}),F.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 h-[85vh] border rounded-lg overflow-hidden shadow-inner",children:e.jsx("iframe",{width:"100%",height:"100%",frameBorder:"0",scrolling:"no",marginHeight:"0",marginWidth:"0",src:u})}),e.jsx("div",{className:"lg:col-span-1 h-[85vh] overflow-y-auto",children:e.jsx("div",{className:"space-y-4",children:l.map(s=>{var c;return e.jsxs("div",{className:"p-3 bg-white rounded-lg shadow hover:shadow-md transition-shadow duration-200 cursor-pointer",onClick:()=>x(s.barangay),children:[e.jsxs("h3",{className:"font-semibold",children:[s.firstname," ",s.lastname]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["RSBSA: ",s.register_id]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Livelihood: ",(c=s.farm_profile)==null?void 0:c.main_livelihood]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Barangay: ",s.barangay]}),y[s.barangay]&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Coordinates: ",y[s.barangay].lat,", ",y[s.barangay].lng]})]},s.id)})})})]})]})}function ee(){var C;const{personal_informations:n}=B(t=>t.personal_information),{user:f}=B(t=>t.app),[m,r]=d.useState(null),[a,x]=d.useState(!1),[l,j]=d.useState(!0),[o,u]=d.useState(!1),[s,c]=d.useState(null),[i,h]=d.useState(!1),p=["active","inactive"],k=new URLSearchParams(window.location.search).get("status");d.useEffect(()=>{(async()=>{try{await N.dispatch(_())}finally{j(!1)}})()},[]);const L=async(t,w)=>{r(null),x(!0);try{await N.dispatch(E({...t,status:w})),N.dispatch(_()),await b.fire({title:"Success!",text:`Status updated successfully to ${w}`,icon:"success",showConfirmButton:!1,timer:1500})}catch(g){console.error("Error updating status:",g),await b.fire({title:"Error!",text:"Failed to update status",icon:"error",showConfirmButton:!0})}finally{x(!1)}},R=t=>{c(t),u(!0)};return l?e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx(A,{size:"h-8 w-8",color:"text-green-500"}),e.jsx("span",{className:"ml-2",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{isLoading:a}),e.jsx(I,{isOpen:o,setIsOpen:u,beneficiaryId:s}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 mt-8",children:[e.jsxs("div",{className:"sm:flex sm:items-center",children:[e.jsxs("div",{className:"sm:flex-auto",children:[e.jsx("h1",{className:"text-base font-semibold text-gray-900",children:"Active Beneficiary"}),e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:"A list of all the active benefeciary in the system including their rsbsa number, registration no., fullname, association and livelihood."})]}),e.jsx("div",{className:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none space-x-4",children:e.jsx("button",{onClick:()=>h(!i),className:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500",children:i?"Show Table":"Show Map"})})]}),i?e.jsx("div",{className:"mt-8",children:e.jsx(T,{beneficiaries:(n==null?void 0:n.data)||[],filters:{status:k}})}):e.jsx("div",{className:"mt-8 flow-root",children:e.jsx("div",{className:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:e.jsx("div",{className:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-3 pl-4 pr-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500 sm:pl-0",children:"RSBSA No."}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Register No."}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Lastname"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Firstname"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Middlename"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Livelihood/Organization"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Status"}),e.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500",children:"Barangay"}),e.jsx("th",{scope:"col",className:"relative py-3 pl-3 pr-4 sm:pr-0",children:e.jsx("span",{className:"sr-only",children:"Edit"})})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:(C=n==null?void 0:n.data)==null?void 0:C.map(t=>{var w;return e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-0",children:t.register_id}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:t.id}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm uppercase text-gray-900",children:t.lastname}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm uppercase text-gray-900",children:t.firstname}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm uppercase text-gray-900",children:t.middlename}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:e.jsx("p",{className:"text-gray-500 italic",children:((w=t==null?void 0:t.farm_profile)==null?void 0:w.main_livelihood)??"N/A"})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900",children:m===t.id?e.jsx("select",{className:"rounded-md border-gray-300 text-xs focus:border-green-500 focus:ring-green-500",defaultValue:t.status,onChange:g=>L(t,g.target.value),onBlur:()=>r(null),disabled:a,children:a?e.jsxs("div",{className:"flex items-center justify-center py-1",children:[e.jsx(A,{size:"h-4 w-4",color:"text-green-500"}),e.jsx("span",{className:"ml-2",children:"Updating..."})]}):p.map(g=>e.jsx("option",{value:g,children:g},g))}):e.jsx("span",{onClick:()=>r(t.id),className:`inline-flex cursor-pointer items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset ${t.status==="active"?"bg-green-50 text-green-700 ring-green-600/20":t.status==="inactive"?"bg-yellow-50 text-yellow-700 ring-yellow-600/20":"bg-red-50 text-red-700 ring-red-600/20"}`,children:t.status})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm uppercase text-gray-900",children:t.barangay}),e.jsx("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($,{href:`/administrator/profile/${t.id}`,className:"text-indigo-600 hover:text-indigo-900",children:["View Profile",e.jsxs("span",{className:"sr-only",children:[", ",t.rsbsa]})]}),k==="active"&&e.jsx("button",{onClick:()=>R(t.id),className:"inline-flex items-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500",children:"Request Subsidy"})]})})]},t.email)})})]})})})})]})]})}export{ee as default};
